import{s as J,_ as Q}from"./formCustomisation-44f18b9b.js";import{d as P,c as T,k as _,l as n,g as u,h as t,w as k,y as b,F as M,G as H,f as $,af as W,r as U,e as i,t as C,L as N,aK as A,X as R,A as D,b as ee,aM as te,M as ae,a6 as V,Y as se,ax as z,z as K,R as F,Z as oe,u as ne,$ as le,aN as L,au as ie}from"./index-54e545bb.js";import{_ as re}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-04848fc3.js";import{I as ce}from"./more-horizontal-b561c647.js";import{d as l}from"./dayjs-8f71cd34.js";import{L as de}from"./knowledgeBase-de4d1c97.js";import{g as ue}from"./globalStore-842ad0ec.js";import{a as me,_ as fe}from"./TicketFeedback.vue_vue_type_script_setup_true_lang-525e5c2e.js";import{I as O}from"./symbols-7dbf6ecf.js";import{_ as pe}from"./Avatar.vue_vue_type_script_setup_true_lang-33c4215a.js";import{_ as _e}from"./TicketConversation.vue_vue_type_script_setup_true_lang-a31c238b.js";import{_ as be}from"./TicketCustomerTemplateFields.vue_vue_type_script_setup_true_lang-980b5ad0.js";import{_ as ke}from"./TicketFeedback.vue_vue_type_script_setup_true_lang-ca6ffb0e.js";import{_ as xe}from"./TicketTextEditor.vue_vue_type_script_setup_true_lang-d737e6e9.js";import"./Dropdown.vue_vue_type_script_setup_true_lang-20398480.js";import"./StarRating.vue_vue_type_script_setup_true_lang-87d7ba3b.js";import"./TicketCommunication.vue_vue_type_script_setup_true_lang-513143c6.js";import"./EmailContent-821cc341.js";import"./AttachmentItem.vue_vue_type_script_setup_true_lang-f98cb03f.js";import"./UserAvatar.vue_vue_type_script_setup_true_lang-73349f36.js";import"./index-587a74f3.js";import"./FileUploader-3bc7c8ba.js";import"./TextEditor-bf30f06f.js";const ve={class:"flex w-[382px] flex-col border-l gap-4"},ge={class:"flex flex-col gap-4 pt-0 px-5 py-3 border-b"},ye={class:"flex gap-2"},he={class:"flex items-center justify-between"},we={class:"w-[242px] truncate text-2xl font-medium"},Ce={key:0,class:"flex gap-1.5"},$e={class:"flex items-center text-base leading-5"},Te={class:"w-[126px] text-sm text-gray-600"},Ie={class:"text-base text-gray-800 flex-1"},Se={class:"w-[126px] text-gray-600 text-sm"},De={class:"break-words text-base text-gray-800"},Fe={class:"flex flex-col gap-4 pt-0 px-5 py-3"},Be={class:"flex items-center text-base leading-5"},Ae={class:"w-[126px] text-sm text-gray-600"},Re={class:"text-base text-gray-800 flex-1"},je=P({__name:"TicketCustomerSidebar",emits:["open"],setup(I,{emit:y}){const f=y,e=W(O),x=T(()=>{const s=v(),r=m();return[{title:"First Response",value:e.data.first_responded_on||e.data.response_by,label:s.label,theme:s.color},{title:"Resolution",value:e.data.resolution_date||e.data.resolution_by,label:r.label,theme:r.color}]});function v(){let s=null;return!e.data.first_responded_on&&l().isBefore(l(e.data.response_by))?s={label:`Due in ${A(l(e.data.response_by).diff(l(),"s"))}`,color:"orange"}:l(e.data.first_responded_on).isBefore(l(e.data.response_by))?s={label:`Fulfilled in ${A(l(e.data.first_responded_on).diff(l(e.data.creation),"s"))}`,color:"green"}:s={label:"Failed",color:"red"},s}function m(){let s=null;return!e.data.resolution_date&&l().isBefore(e.data.resolution_by)?s={label:`Due in ${A(l(e.data.resolution_by).diff(l(),"s"))}`,color:"orange"}:l(e.data.resolution_date).isBefore(e.data.resolution_by)?s={label:`Fulfilled in ${A(l(e.data.resolution_date).diff(l(e.data.creation),"s"))}`,color:"green"}:s={label:"Failed",color:"red"},s}const h=T(()=>[{label:"Ticket ID",value:e.data.name},{label:"Status",value:B(e.data.status),bold:!0}]),g=T(()=>{const s=[{label:"Subject",value:e.data.subject},{label:"Team",value:e.data.agent_group||"-"},{label:"Priority",value:e.data.priority}],r=e.data.template.fields.filter(p=>!p.hide_from_customer&&["subject","team","priority"].indexOf(p.fieldname)===-1).map(p=>({label:p.label,value:e.data[p.fieldname]}));return[...s,...r]});function B(s){switch(s){case"Replied":return"Awaiting reply";default:return s}}return(s,r)=>{const p=fe,S=U("Button"),j=U("Badge"),E=me;return i(),_("div",ve,[r[1]||(r[1]=n("div",{class:"flex items-center justify-between border-b px-5 py-3"},[n("span",{class:"cursor-copy text-lg font-semibold"},"Ticket details")],-1)),n("div",ge,[n("div",ye,[u(t(pe),{size:"2xl",image:t(e).data.contact.image,label:t(e).data.contact.name},null,8,["image","label"]),n("div",he,[u(t(N),{text:t(e).data.contact.name},{default:k(()=>[n("div",we,C(t(e).data.contact.name),1)]),_:1},8,["text"]),t(e).data.feedback_rating?b("",!0):(i(),_("div",Ce,[u(t(N),{text:t(e).data.contact.email_id},{default:k(()=>[u(S,{class:"h-7 w-7",onClick:r[0]||(r[0]=c=>f("open"))},{icon:k(()=>[u(p,{class:"h-4 w-4"})]),_:1})]),_:1},8,["text"])]))])]),(i(!0),_(M,null,H(h.value,c=>(i(),_("div",$e,[n("span",Te,C(c.label),1),n("span",Ie,C(c.value),1)]))),256)),(i(!0),_(M,null,H(x.value,c=>(i(),_("div",{key:c.label,class:"flex items-center text-base"},[n("div",Se,C(c.title),1),n("div",De,[u(t(N),{text:t(l)(c.value).long()},{default:k(()=>[u(j,{label:c.label,theme:c.theme,variant:"outline"},null,8,["label","theme"])]),_:2},1032,["text"])])]))),128))]),t(e).data.feedback_rating?(i(),$(E,{key:0,class:"border-b text-base text-gray-600",ticket:t(e).data},null,8,["ticket"])):b("",!0),n("div",Fe,[(i(!0),_(M,null,H(g.value,c=>(i(),_("div",Be,[n("span",Ae,C(c.label),1),n("span",Re,C(c.value),1)]))),256))])])}}});function Ee(I,y=!1,f,e,x){return R({url:"helpdesk.helpdesk.doctype.hd_ticket.api.get_one",cache:["Ticket",I],params:{name:I,is_customer_portal:y},auto:!0,transform:m=>{f&&f(m)},onSuccess:m=>{e&&e(m)},onError:m=>{console.log("here"),x&&x(m)}})}const Me={key:0,class:"flex flex-col"},He={class:"flex overflow-hidden h-full w-full"},Ne={class:"flex flex-col flex-1 max-w-[calc(100%-382px)]"},Ue=["onKeydownCapture"],ct=P({__name:"TicketCustomer",props:{ticketId:{}},setup(I){const y=ne(),f=I,e=Ee(f.ticketId,!0,null,o=>{J(e,{doc:o,call:oe,router:y,toast:F,$dialog:s,updateField:p,createToast:F.create})},()=>{F.error("Ticket not found"),y.replace("/my-tickets")});le(O,e);const x=D(null),v=D(""),m=D([]),h=D(!1),g=D(!1),{isMobileView:B}=ee(),{$dialog:s}=ue(),r=R({url:"run_doc_method",debounce:300,makeParams:()=>({dt:"HD Ticket",dn:f.ticketId,method:"create_communication_via_contact",args:{message:v.value,attachments:m.value}}),onSuccess:()=>{x.value.editor.commands.clearContent(!0),m.value=[],g.value=!1,e.reload()}});function p(o,a,w=()=>{}){j(o,a),w()}function S(){ie(v.value)||r.loading||r.submit()}function j(o,a){R({url:"frappe.client.set_value",params:{doctype:"HD Ticket",name:f.ticketId,fieldname:o,value:a},auto:!0,onSuccess:()=>{e.reload(),F.success("Ticket updated")}})}function E(){q.value?h.value=!0:c()}function c(){s({title:"Close Ticket",message:"Are you sure you want to close this ticket?",actions:[{label:"Confirm",variant:"solid",onClick(o){e.data.status="Closed",G.submit({fieldname:"status",value:"Closed"},{onSuccess:()=>{F.success("Ticket closed")}}),o()}}]})}const G=R({url:"frappe.client.set_value",debounce:300,makeParams:o=>({doctype:"HD Ticket",name:f.ticketId,fieldname:o.fieldname,value:o.value}),onSuccess:()=>{h.value=!1,e.reload()}}),X=T(()=>{var a;let o=[{label:"Tickets",route:{name:"TicketsCustomer"}}];return o.push({label:(a=e.data)==null?void 0:a.subject,route:{name:"TicketCustomer"}}),o}),Y=T(()=>e.data.status!=="Closed"),{isFeedbackMandatory:Z}=te(),q=T(()=>{var a,w;return((w=(a=e.data)==null?void 0:a.communications)==null?void 0:w.some(d=>d.sender!==e.data.raised_by))&&Z});return ae(()=>{document.title=f.ticketId,V.on("helpdesk:ticket-update",o=>{o===Number(f.ticketId)&&e.reload()})}),se(()=>{document.title="Helpdesk",V.off("helpdesk:ticket-update")}),(o,a)=>{const w=Q;return t(e).data?(i(),_("div",Me,[u(t(de),null,{"left-header":k(()=>[u(t(re),{items:X.value},null,8,["items"])]),"right-header":k(()=>[t(e).data._customActions?(i(),$(w,{key:0,actions:t(e).data._customActions},null,8,["actions"])):b("",!0),t(e).data.status!=="Closed"?(i(),$(t(L),{key:1,label:"Close",theme:"gray",variant:"solid",onClick:a[0]||(a[0]=d=>E())},{prefix:k(()=>[u(t(ce),{icon:"lucide:check"})]),_:1})):b("",!0)]),_:1}),n("div",He,[n("section",Ne,[t(B)?(i(),$(be,{key:0})):b("",!0),u(_e,{class:"grow"}),n("div",{class:"w-full p-5",onKeydownCapture:[z(K(S,["ctrl","stop"]),["enter"]),z(K(S,["meta","stop"]),["enter"])]},[Y.value?(i(),$(xe,{key:0,ref_key:"editor",ref:x,attachments:m.value,"onUpdate:attachments":a[1]||(a[1]=d=>m.value=d),content:v.value,"onUpdate:content":a[2]||(a[2]=d=>v.value=d),expand:g.value,"onUpdate:expand":a[3]||(a[3]=d=>g.value=d),placeholder:"Type a message",autofocus:"",onClear:a[4]||(a[4]=()=>g.value=!1)},{"bottom-right":k(()=>{var d;return[u(t(L),{label:"Send",theme:"gray",variant:"solid",disabled:((d=o.$refs.editor)==null?void 0:d.editor.isEmpty)||t(r).loading,loading:t(r).loading,onClick:S},null,8,["disabled","loading"])]}),_:1},8,["attachments","content","expand"])):b("",!0)],40,Ue)]),t(B)?b("",!0):(i(),$(je,{key:0,onOpen:a[5]||(a[5]=d=>g.value=!0)}))]),u(ke,{open:h.value,"onUpdate:open":a[6]||(a[6]=d=>h.value=d)},null,8,["open"])])):b("",!0)}}});export{ct as default};
//# sourceMappingURL=TicketCustomer-a1b8310f.js.map
