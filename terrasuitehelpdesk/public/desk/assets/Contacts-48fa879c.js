import{j as ae,e as C,k as U,l as v,av as le,a3 as O,c as I,d as H,A as N,X as oe,R as k,g as f,w as B,h as s,r as z,F as K,G as Z,s as ne,t as X,y as q,f as E,aZ as Q,a$ as W,b0 as se,H as Y,b1 as G,b2 as ie,aN as re,b3 as ue,ax as ce,a as de,a_ as me,Z as pe,N as ve,O as fe,I as _e,U as ge}from"./index-54e545bb.js";import{_ as ee}from"./Avatar.vue_vue_type_script_setup_true_lang-33c4215a.js";import{a as Ce}from"./more-horizontal-b561c647.js";import"./dayjs-8f71cd34.js";import{L as ye}from"./knowledgeBase-de4d1c97.js";import{_ as he}from"./ListViewBuilder.vue_vue_type_script_setup_true_lang-23f24b4c.js";import{F as be}from"./FileUploader-3bc7c8ba.js";import{s as D}from"./dialogState-e18b28cc.js";import"./Dropdown.vue_vue_type_script_setup_true_lang-20398480.js";import"./StarRating.vue_vue_type_script_setup_true_lang-87d7ba3b.js";import"./FadedScrollableDiv.vue_vue_type_script_setup_true_lang-897d9728.js";import"./DateRangePicker.vue_vue_type_script_setup_true_lang-fc0fa242.js";import"./Link-5130f40e.js";import"./globalStore-842ad0ec.js";import"./EmptyState.vue_vue_type_script_setup_true_lang-93f57bdf.js";const xe={},Ve={width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function ke(_,u){return C(),U("svg",Ve,u[0]||(u[0]=[v("path",{d:"M10.381 15.0091L13.0108 12.8044C13.3009 12.5612 13.7186 12.5445 14.0272 12.7639L16.5838 14.5815C17.0394 14.9054 17.0522 15.5775 16.6093 15.9186L15.6001 16.6955C14.9561 17.1913 14.0933 17.2956 13.3711 16.9225C11.824 16.1231 9.08016 14.5487 7.11025 12.5456C5.21236 10.6158 3.81881 8.0839 3.08578 6.57321C2.70649 5.79154 2.88609 4.87094 3.48778 4.24418L4.42402 3.26893C4.7989 2.87842 5.441 2.94435 5.72871 3.40288L7.34325 5.976C7.55012 6.3057 7.50072 6.73477 7.22432 7.00882L4.62919 9.58191",stroke:"currentColor","stroke-linejoin":"round"},null,-1)]))}const Ne=ae(xe,[["render",ke]]),Ee=le("contact",()=>{const _=O({doctype:"Contact",fields:["*"],auto:!0,pageLength:99999});return{options:I(()=>{var g;return((g=_.list)==null?void 0:g.data)||[]})}}),we={class:"space-y-4"},$e={class:"mb-2 block text-sm leading-4 text-gray-700"},De={key:0,class:"place-self-center text-red-500"},Ie={class:"flex justify-end space-x-2"},Ue=H({__name:"NewContactDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","close","contactCreated"],setup(_,{emit:u}){const g=_,y=u,d=Ee(),l=N({emailID:"",firstName:"",lastName:"",phone:"",selectedCustomer:null}),r=N({emailValidationError:"",firstNameValidationError:"",lastNameValidationError:"",phoneValidationError:"",customerValidationError:""}),b=[{label:"Email Id",value:"emailID",error:"emailValidationError",type:"input",required:!0,action:()=>R(l.value.emailID)},{label:"First Name",value:"firstName",error:"firstNameValidationError",type:"input",required:!0,action:()=>S(l.value.firstName)},{label:"Last Name",value:"lastName",error:"lastNameValidationError",type:"input",required:!1},{label:"Phone",value:"phone",error:"phoneValidationError",type:"input",required:!1,action:()=>F(l.value.phone)},{label:"Customer",value:"selectedCustomer",error:"customerValidationError",type:"autocomplete",required:!1}],i=I({get:()=>g.modelValue,set:o=>{y("update:modelValue",o),o||y("close")}}),n=O({doctype:"HD Customer",fields:["name"],cache:"customers",transform:o=>o.map(c=>({label:c.name,value:c.name})),auto:!0}),m=oe({url:"frappe.client.insert",onSuccess:()=>{l.value={emailID:"",firstName:"",lastName:"",phone:"",selectedCustomer:null},k.success("Contact created"),y("contactCreated")}});function w(){if(M())return;let o={doctype:"Contact",first_name:l.value.firstName,last_name:l.value.lastName,email_ids:[{email_id:l.value.emailID,is_primary:!0}],links:[],phone_nos:[]};l.value.phone&&(o.phone_nos=[{phone:l.value.phone}]),l.value.selectedCustomer&&o.links.push({link_doctype:"HD Customer",link_name:l.value.selectedCustomer}),m.submit({doc:o})}function a(o){!o||o.label==="No label"?l.value.selectedCustomer=null:l.value.selectedCustomer=o.value}function M(){let o=R(l.value.emailID);return o+=S(l.value.firstName),o+=F(l.value.phone),o}function R(o){r.value.emailValidationError="";const c=G.string().email().safeParse(o).success;return o?c?j(d.options).includes(o)&&(r.value.emailValidationError="Contact with email already exists"):r.value.emailValidationError="Enter a valid email":r.value.emailValidationError="Email should not be empty",r.value.emailValidationError}function S(o){return r.value.firstNameValidationError="",(!o||o.trim()==="")&&(r.value.firstNameValidationError="First name should not be empty"),r.value.firstNameValidationError}function F(o){return r.value.phoneValidationError="",o&&(!/[0-9]+/.test(o)||o.length<10)&&(r.value.phoneValidationError="Enter a valid phone number"),r.value.phoneValidationError}function j(o){return o.map(c=>c.email_id)}return(o,c)=>{const A=z("Button");return C(),U("div",null,[f(s(Y),{modelValue:i.value,"onUpdate:modelValue":c[1]||(c[1]=e=>i.value=e),options:{title:"Create New Contact"}},{"body-content":B(()=>[v("div",we,[(C(),U(K,null,Z(b,e=>v("div",{key:e.label,class:"flex flex-col gap-1"},[v("span",$e,[ne(X(e.label)+" ",1),e.required?(C(),U("span",De," * ")):q("",!0)]),e.type==="input"?(C(),E(s(Q),{key:0,modelValue:l.value[e.value],"onUpdate:modelValue":t=>l.value[e.value]=t,type:"text",onBlur:e.action},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(C(),E(s(W),{key:1,modelValue:l.value[e.value],"onUpdate:modelValue":[t=>l.value[e.value]=t,a],options:s(n).data},null,8,["modelValue","onUpdate:modelValue","options"])),f(s(se),{message:r.value[e.error]},null,8,["message"])])),64)),v("div",Ie,[f(A,{label:"Create",loading:s(m).loading,theme:"gray",variant:"solid",onClick:c[0]||(c[0]=e=>w())},null,8,["loading"])])])]),_:1},8,["modelValue"])])}}}),Be={__name:"Pill",props:{label:{type:String,default:"Button",require:!0},disabled:{type:Boolean,default:!1}},emits:["click"],setup(_,{emit:u}){const g=u,y=d=>{g("click",d)};return(d,l)=>(C(),E(s(re),{key:_.label,theme:"gray",variant:"outline",label:_.label,disabled:_.disabled},{suffix:B(()=>[f(s(ie),{class:"h-3 w-3",onClick:l[0]||(l[0]=r=>y(_.label))})]),_:1},8,["label","disabled"]))}},Se={class:"flex flex-wrap gap-2 rounded-lg bg-gray-100 p-2"},J=H({__name:"MultiSelect",props:{items:{type:Array,required:!0},placeholder:{type:String,required:!1,default:"Type..."},validate:{type:Function,required:!1,default:()=>!1}},emits:["update:items"],setup(_,{emit:u}){const g=_,y=u,{items:d}=ue(g),l=N("");function r(i){const n=g.validate(i);if(n){k.error(n);return}const m=[...d.value,i];y("update:items",m),l.value=""}function b(i){const n=d.value.filter(m=>m.value!==i);y("update:items",n)}return(i,n)=>(C(),U("div",Se,[(C(!0),U(K,null,Z(s(d),m=>(C(),E(Be,{key:m.value,label:m.label,onClick:n[0]||(n[0]=w=>b(w))},null,8,["label"]))),128)),f(s(Q),{modelValue:l.value,"onUpdate:modelValue":n[1]||(n[1]=m=>l.value=m),class:"w-full",placeholder:_.placeholder,onKeyup:n[2]||(n[2]=ce(m=>r({label:l.value,value:l.value}),["enter"]))},null,8,["modelValue","placeholder"])]))}}),Pe={class:"flex flex-col items-center gap-4 p-6"},Le={class:"text-xl font-medium text-gray-900"},Re={class:"flex gap-2"},Fe={class:"w-full space-y-2 text-sm text-gray-700"},qe={class:"space-y-1"},He={class:"space-y-1"},Me={class:"space-y-1"},je=H({__name:"ContactDialog",props:{name:{}},emits:["contactUpdated"],setup(_,{emit:u}){const g=_,y=u,d=N(!1),l=I({get(){var t;return(((t=a.doc)==null?void 0:t.email_ids)||[]).map(p=>({label:p.email_id,value:p.email_id}))},set(e){if(e.length===0){k.error("At least one email is required");return}e.length!==a.doc.email_ids.length&&(d.value=!0),a.doc.email_ids=e.map(t=>({email_id:t.value}))}}),r=I({get(){var t;return(((t=a.doc)==null?void 0:t.phone_nos)||[]).map(p=>({label:p.phone,value:p.phone}))},set(e){e.length!==a.doc.phone_nos.length&&(d.value=!0),a.doc.phone_nos=e.map(t=>({phone:t.value}))}}),b=I({get(){var t,p;const e=(p=(t=a.doc)==null?void 0:t.links)==null?void 0:p.find(V=>V.link_doctype==="HD Customer");return(e==null?void 0:e.link_name)||null},set(e){var p,V,$,P,L;const t=($=(V=(p=a.doc)==null?void 0:p.links)==null?void 0:V.find(x=>x.link_doctype==="HD Customer"))==null?void 0:$.link_name;if(e!==t){if(e){const x=(P=a.doc.links)==null?void 0:P.findIndex(h=>h.link_doctype==="HD Customer");x!==-1?a.doc.links[x].link_name=e:a.doc.links.push({link_doctype:"HD Customer",link_name:e})}else a.doc.links=(L=a.doc.links)==null?void 0:L.filter(x=>x.link_doctype!=="HD Customer");d.value=!0}}}),i=O({doctype:"HD Customer",fields:["name"],cache:"customers",transform:e=>e.map(t=>({label:t.name,value:t.name})),auto:!0});function n(e){!e||e.label==="No label"?b.value=null:b.value=e.value}const{updateOnboardingStep:m}=Ce("helpdesk"),{isManager:w}=de(),a=me({doctype:"Contact",name:g.name,auto:!0,setValue:{onSuccess(){y("contactUpdated")}}}),M=I(()=>{var e;return{title:(e=a.doc)==null?void 0:e.name,actions:[{label:"Save",theme:"gray",variant:"solid",onClick:()=>R()}]}});function R(){if(!d.value){k.error("No changes to save");return}a.setValue.submit({email_ids:l.value.map(e=>({email_id:e.value,is_primary:e.value===a.doc.email_id})),phone_nos:r.value.map(e=>({phone:e.value,is_primary_phone:e.value===a.doc.phone,is_primary_mobile:e.value===a.doc.phone})),links:a.doc.links})}function S(e){a.setValue.submit({image:(e==null?void 0:e.file_url)||null}),d.value=!0}function F(e){if(!G.string().email().safeParse(e.value).success)return"Invalid email"}function j(e){if(!G.string().regex(/^\+[1-9]\d{1,14}$/).min(10).max(15).safeParse(e.value).success)return"Invalid phone number"}function o(e){let t=e.name.split(".").pop().toLowerCase();if(!["png","jpg","jpeg"].includes(t))return k.error("Invalid file type, only PNG and JPG images are allowed"),"Invalid file type, only PNG and JPG images are allowed"}const c=N(!1);async function A(){var e;try{c.value=!0;const t=await pe("frappe.contacts.doctype.contact.contact.invite_user",{contact:a.doc.name});k.success("Contact invited successfully"),await a.setValue.submit({user:t}),m("add_invite_contact")}catch(t){c.value=!1;const $=new DOMParser().parseFromString(((e=t.messages)==null?void 0:e[0])||t.message,"text/html").body.innerText;k.error($)}finally{c.value=!1}}return(e,t)=>{const p=z("Button");return C(),E(s(Y),{options:M.value},{"body-main":B(()=>{var V,$,P,L,x;return[v("div",Pe,[v("div",Le,X((V=s(a).doc)==null?void 0:V.full_name),1),f(s(ee),{size:"2xl",label:($=s(a).doc)==null?void 0:$.full_name,image:(P=s(a).doc)==null?void 0:P.image,class:"cursor-pointer hover:opacity-80"},null,8,["label","image"]),v("div",Re,[f(s(be),{"validate-file":o,onSuccess:t[0]||(t[0]=h=>S(h))},{default:B(({uploading:h,openFileSelector:te})=>{var T;return[f(p,{label:(T=s(a).doc)!=null&&T.image?"Change photo":"Upload photo",loading:h,onClick:te},null,8,["label","loading","onClick"])]}),_:1}),(L=s(a).doc)!=null&&L.image?(C(),E(p,{key:0,label:"Remove photo",onClick:t[1]||(t[1]=h=>S(null))})):q("",!0),!((x=s(a).doc)!=null&&x.user)&&s(w)?(C(),E(p,{key:1,label:"Invite as user",onClick:A,loading:c.value},null,8,["loading"])):q("",!0)]),v("div",Fe,[v("div",qe,[t[5]||(t[5]=v("div",{class:"text-xs"},"Emails",-1)),f(J,{items:l.value,"onUpdate:items":t[2]||(t[2]=h=>l.value=h),placeholder:"john.doe@example.com",validate:F},null,8,["items"])]),v("div",He,[t[6]||(t[6]=v("div",{class:"text-xs"},"Phone Nos",-1)),f(J,{items:r.value,"onUpdate:items":t[3]||(t[3]=h=>r.value=h),placeholder:"+91 98765 43210",validate:j},null,8,["items"])]),v("div",Me,[t[7]||(t[7]=v("div",{class:"text-xs"},"Customer",-1)),f(s(W),{modelValue:b.value,"onUpdate:modelValue":[t[4]||(t[4]=h=>b.value=h),n],options:s(i).data},null,8,["modelValue","options"])])])])]}),_:1},8,["options"])}}}),Ae={class:"flex flex-col"},ot=H({__name:"Contacts",setup(_){const u=N(!1),g=N(null),y=N(null),d=I(()=>({doctype:"Contact",selectable:!0,showSelectBanner:!0,columnConfig:{full_name:{prefix:({row:i})=>_e(ee,{shape:"circle",image:i.image,label:i.name,size:"sm"})},mobile_no:{prefix:Ne}},emptyState:{title:"No Contacts Found"}}));function l(){var i;D.value=!1,(i=y.value)==null||i.reload()}function r(i){g.value=i,u.value=!0}function b(){var i;k.success("Contact updated"),u.value=!u.value,(i=y.value)==null||i.reload()}return ve(()=>({title:"Contacts"})),(i,n)=>{const m=ge,w=z("Button");return C(),U("div",Ae,[f(s(ye),null,{"left-header":B(()=>n[4]||(n[4]=[v("div",{class:"text-lg font-medium text-gray-900"},"Contacts",-1)])),"right-header":B(()=>[f(w,{label:"New contact",theme:"gray",variant:"solid",onClick:n[0]||(n[0]=a=>D.value=!s(D))},{prefix:B(()=>[f(m,{class:"h-4 w-4"})]),_:1})]),_:1}),f(s(he),{ref_key:"listViewRef",ref:y,options:d.value,onRowClick:r,onEmptyStateAction:n[1]||(n[1]=a=>D.value=!0)},null,8,["options"]),f(Ue,{modelValue:s(D),"onUpdate:modelValue":n[2]||(n[2]=a=>fe(D)?D.value=a:null),onContactCreated:l},null,8,["modelValue"]),u.value?(C(),E(je,{key:g.value,modelValue:u.value,"onUpdate:modelValue":n[3]||(n[3]=a=>u.value=a),name:g.value,onContactUpdated:b},null,8,["modelValue","name"])):q("",!0)])}}});export{ot as default};
//# sourceMappingURL=Contacts-48fa879c.js.map
