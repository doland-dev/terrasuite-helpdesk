import{j as ue,e as a,k as V,l as m,d as ce,m as X,n as I,p as de,f as M,w as f,r as $,g as r,q as me,b as Ve,s as pe,t as P,h as y,v as oe,x as ne,y as q,z as fe,A as U,c as Y,B as K,C as $e,D as Le,E as Te,F as Q,G as W,P as Se,H as Me,a as Ne,I as k,J as F,K as T,L as se,M as De,N as Be,O as Ae,Q as ie,R as Re,u as Fe,T as Ee,S as ae,U as He}from"./index-54e545bb.js";import{I as je,u as Pe,c as z}from"./more-horizontal-b561c647.js";import{d as B}from"./dayjs-8f71cd34.js";import{L as Ue}from"./knowledgeBase-de4d1c97.js";import{_ as ze,E as Oe}from"./ListViewBuilder.vue_vue_type_script_setup_true_lang-23f24b4c.js";import{u as qe,I as Ie}from"./ticketStatus-b2a972bb.js";import{_ as re}from"./Dropdown-a6c1fbb4.js";import{g as Je}from"./globalStore-842ad0ec.js";import"./Dropdown.vue_vue_type_script_setup_true_lang-20398480.js";import"./StarRating.vue_vue_type_script_setup_true_lang-87d7ba3b.js";import"./FadedScrollableDiv.vue_vue_type_script_setup_true_lang-897d9728.js";import"./Avatar.vue_vue_type_script_setup_true_lang-33c4215a.js";import"./DateRangePicker.vue_vue_type_script_setup_true_lang-fc0fa242.js";import"./Link-5130f40e.js";import"./EmptyState.vue_vue_type_script_setup_true_lang-93f57bdf.js";const Ze={},Ge={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Ke(d,c){return a(),V("svg",Ge,c[0]||(c[0]=[m("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M6.17683 1C4.89138 1 3.81543 1.97482 3.68896 3.25405L3.19111 8.2899C3.16577 8.54615 3.0749 8.79156 2.92723 9.00252L1.98134 10.3538C1.51739 11.0166 1.99155 11.9273 2.80057 11.9273H7.53349V14.4999C7.53349 14.7761 7.75735 14.9999 8.03349 14.9999C8.30963 14.9999 8.53349 14.7761 8.53349 14.4999V11.9273H13.2016C14.0107 11.9273 14.4848 11.0166 14.0209 10.3538L13.068 8.99254C12.9236 8.78634 12.8335 8.54713 12.8059 8.29695L12.246 3.22567C12.1062 1.95882 11.0357 1 9.76113 1H6.17683ZM4.68411 3.35243C4.75999 2.5849 5.40556 2 6.17683 2H9.76113C10.5259 2 11.1682 2.57529 11.2521 3.3354L11.8119 8.40668C11.858 8.82365 12.0082 9.22233 12.2488 9.566L13.2016 10.9273H2.80057L3.74646 9.57598C3.99257 9.22439 4.14403 8.81536 4.18625 8.38828L4.68411 3.35243Z",fill:"currentColor"},null,-1)]))}const Qe=ue(Ze,[["render",Ke]]),We={},Xe={width:"15",height:"14",viewBox:"0 0 15 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Ye(d,c){return a(),V("svg",Xe,c[0]||(c[0]=[m("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M5.1783 0C3.89284 0 2.81689 0.974825 2.69042 2.25405L2.19257 7.2899C2.16724 7.54615 2.07636 7.79156 1.92869 8.00252L0.982801 9.35379C0.518857 10.0166 0.99301 10.9273 1.80203 10.9273H6.53506V13.4998C6.53506 13.776 6.75892 13.9998 7.03506 13.9998C7.31121 13.9998 7.53506 13.776 7.53506 13.4998V10.9273H12.2031C13.0121 10.9273 13.4863 10.0166 13.0223 9.35379L12.0695 7.99254C11.9251 7.78634 11.835 7.54713 11.8074 7.29695L11.2475 2.22567C11.1076 0.958818 10.0371 0 8.76259 0H5.1783ZM3.68557 2.35243C3.76145 1.5849 4.40702 1 5.1783 1H8.76259C9.52732 1 10.1696 1.57529 10.2535 2.3354L10.8134 7.40668C10.8594 7.82365 11.0097 8.22233 11.2502 8.566L12.2031 9.92725H1.80203L2.74793 8.57598C2.99404 8.22439 3.1455 7.81536 3.18772 7.38828L3.68557 2.35243Z",fill:"currentColor"},null,-1),m("rect",{x:"0.792893",width:"2",height:"17",rx:"1",transform:"rotate(-45 0.792893 0)",fill:"currentColor",class:"stroke stroke-ink-white"},null,-1)]))}const et=ue(We,[["render",Ye]]),tt={class:"mt-3"},lt=ce({__name:"ExportModal",props:X({rowCount:{}},{modelValue:{},modelModifiers:{}}),emits:X(["update"],["update:modelValue"]),setup(d,{emit:c}){const n=c,p=I(d,"modelValue"),v=de({export_type:"Excel",export_all:!1});return(L,b)=>{const i=$("FormControl"),_=$("Button"),o=$("Dialog");return a(),M(o,{modelValue:p.value,"onUpdate:modelValue":b[3]||(b[3]=l=>p.value=l),options:{title:"Export"}},{"body-content":f(()=>[r(i,{modelValue:v.export_type,"onUpdate:modelValue":b[0]||(b[0]=l=>v.export_type=l),variant:"outline",label:"Export Type",type:"select",options:[{label:"Excel",value:"Excel"},{label:"CSV",value:"CSV"}],placeholder:"Excel"},null,8,["modelValue"]),m("div",tt,[r(i,{modelValue:v.export_all,"onUpdate:modelValue":b[1]||(b[1]=l=>v.export_all=l),type:"checkbox",label:`Export All ${L.rowCount} Record(s)`},null,8,["modelValue","label"])])]),actions:f(()=>[r(_,{label:"Download",variant:"solid",onClick:b[2]||(b[2]=()=>n("update",v)),class:"w-full"})]),_:1},8,["modelValue"])}}}),ot={class:"flex items-center"},nt=["onClick"],st={class:"flex items-center"},it={class:"whitespace-nowrap"},at={class:"flex flex-row-reverse gap-2 items-center min-w-11"},rt={__name:"ViewBreadcrumbs",props:{routeName:{type:String,required:!0},label:{type:String,required:!0},options:{type:Array,required:!0},dropdownActions:{type:Function,required:!0},currentView:{type:Object,required:!0}},setup(d){const c=me(),{isMobileView:n}=Ve(),p=v=>c.query.view?v.name===c.query.view:!1;return(v,L)=>{const b=$("router-link"),i=$("FeatherIcon"),_=$("Button");return a(),V("div",ot,[r(b,{to:{name:d.routeName},class:"px-0.5 py-1 text-lg font-medium focus:outline-none focus-visible:ring-2 focus-visible:ring-outline-gray-3 text-ink-gray-5 hover:text-ink-gray-7 flex items-center justify-center"},{default:f(()=>[pe(P(y(n)?"...":d.label),1)]),_:1},8,["to"]),L[0]||(L[0]=m("span",{class:"mx-0.5 text-base text-ink-gray-4","aria-hidden":"true"}," / ",-1)),r(re,{options:d.options},{default:f(({open:o})=>[r(_,{variant:"ghost",class:"text-lg font-medium text-nowrap",label:d.currentView.label},{prefix:f(()=>[typeof d.currentView.icon=="string"?(a(),M(y(je),{key:0,icon:d.currentView.icon,class:"h-4"},null,8,["icon"])):(a(),M(oe(d.currentView.icon),{key:1,class:"h-4 flex items-center justify-center"}))]),suffix:f(()=>[r(i,{name:o?"chevron-up":"chevron-down",class:"h-4 text-ink-gray-8"},null,8,["name"])]),_:2},1032,["label"])]),item:f(({item:o,active:l})=>[m("button",{class:ne(["group flex text-ink-gray-6 gap-4 h-7 w-full justify-between items-center rounded px-2 text-base",{"bg-surface-gray-3":l}]),onClick:o.onClick},[m("div",st,[o.icon&&typeof o.icon=="string"?(a(),M(i,{key:0,name:o.icon,class:"mr-2 h-4 w-4 flex-shrink-0 text-ink-gray-7","aria-hidden":"true"},null,8,["name"])):o.icon?(a(),M(oe(o.icon),{key:1,class:"mr-2 h-4 w-4 flex-shrink-0 text-ink-gray-7"})):q("",!0),m("span",it,P(o.label),1)]),m("div",at,[o.name?(a(),M(re,{key:0,class:ne(l?"block":"hidden"),placement:"right-start",options:d.dropdownActions(o)},{default:f(({togglePopover:S})=>[r(_,{variant:"ghost",class:"!size-5",icon:"more-horizontal",onClick:fe(E=>S(),["stop"])},null,8,["onClick"])]),_:2},1032,["class","options"])):q("",!0),p(o)?(a(),M(i,{key:1,name:"check",class:"size-4 text-ink-gray-7"})):q("",!0)])],10,nt)]),_:1},8,["options"])])}}},ut={class:"text-base"},ct={key:0,class:"px-2 py-1 flex items-center justify-center gap-2 rounded-full bg-surface-modal shadow-2xl ring-1 ring-black ring-opacity-5 focus:outline-none"},dt=["onClick"],mt={key:1,class:"my-3 max-w-max transform bg-surface-white px-4 sm:px-0"},pt={class:"relative max-h-96 pb-3 overflow-y-auto min-w-40 rounded-lg bg-surface-modal shadow-2xl ring-1 ring-black ring-opacity-5 focus:outline-none"},ft={class:"flex gap-2 px-3 pb-1 pt-3"},vt={class:"flex-1"},wt={class:"sticky top-0 bg-surface-modal pb-2 pt-3 text-sm text-ink-gray-7"},bt={class:"grid w-96 grid-cols-12 place-items-center"},gt=["onClick","title"],kt={__name:"IconPicker",props:{modelValue:{},modelModifiers:{},reaction:{},reactionModifiers:{}},emits:["update:modelValue","update:reaction"],setup(d,{expose:c}){const n=U(""),p=I(d,"modelValue"),v=I(d,"reaction"),L=U(["👍","❤️","😂","😮","😢","🙏"]),b=Y(()=>{let o={};for(let l of K){if(n.value&&![l.description,...l.names,...l.tags].join(" ").toLowerCase().includes(n.value.toLowerCase()))continue;let S=o[l.category];S||(o[l.category]=[],S=o[l.category]),S.push(l)}return Object.keys(o).length||(o["No results"]=[]),o});function i(){let o=K.length,l=_(0,o-1);p.value=K[l].emoji}function _(o,l){return Math.floor(Math.random()*(l-o+1)+o)}return c({setRandom:i}),(o,l)=>{const S=$("Button"),E=$("FormControl");return a(),M(y(Se),{transition:"default"},{target:f(({togglePopover:h,isOpen:C})=>[$e(o.$slots,"default",Le(Te({isOpen:C,togglePopover:h})),()=>[m("span",ut,P(d.modelValue||""),1)])]),body:f(({togglePopover:h})=>[v.value?(a(),V("div",ct,[(a(!0),V(Q,null,W(L.value,C=>(a(),V("div",{class:"size-5 cursor-pointer rounded-full bg-surface-transparent text-xl",key:C,onClick:()=>(p.value=C)&&h()},[m("button",null,P(C),1)],8,dt))),128)),r(S,{class:"rounded-full",icon:"plus",onClick:l[0]||(l[0]=fe(()=>v.value=!1,["stop"]))})])):(a(),V("div",mt,[m("div",pt,[m("div",ft,[m("div",vt,[r(E,{type:"text",placeholder:"Search by keyword",modelValue:n.value,"onUpdate:modelValue":l[1]||(l[1]=C=>n.value=C),debounce:300},null,8,["modelValue"])]),r(S,{onClick:i},{default:f(()=>l[2]||(l[2]=[pe("Random")])),_:1,__:[2]})]),l[3]||(l[3]=m("div",{class:"w-96"},null,-1)),(a(!0),V(Q,null,W(b.value,(C,O)=>(a(),V("div",{class:"px-3",key:O},[m("div",wt,P(O),1),m("div",bt,[(a(!0),V(Q,null,W(C,N=>(a(),V("button",{class:"h-8 w-8 rounded-md p-1 text-2xl hover:bg-surface-gray-2 focus:outline-none focus:ring focus:ring-blue-200",key:N.description,onClick:()=>(p.value=N.emoji)&&h(),title:N.description},P(N.emoji),9,gt))),128))])]))),128))])]))]),_:3})}}},yt={class:"flex gap-2"},_t={__name:"ViewModal",props:{modelValue:{},modelModifiers:{}},emits:X(["update"],["update:modelValue"]),setup(d,{emit:c}){let n=I(d,"modelValue");const p=U({label:n.value.view.label||"",icon:n.value.view.icon||"",name:n.value.view.name||""}),v=Y(()=>({modalTitle:n.value.mode==="edit"?"Edit View":n.value.mode==="duplicate"?"Duplicate View":"Create View",buttonLabel:n.value.mode==="edit"?"Update":n.value.mode==="duplicate"?"Duplicate":"Create",action:n.value.mode==="edit"?"update":n.value.mode==="duplicate"?"duplicate":"create"})),L=c;return(b,i)=>{const _=$("Button"),o=$("FormControl");return a(),M(y(Me),{modelValue:y(n).show,"onUpdate:modelValue":i[3]||(i[3]=l=>y(n).show=l),options:{title:v.value.modalTitle}},{"body-content":f(()=>[i[4]||(i[4]=m("div",{class:"mb-1.5 block text-base text-ink-gray-5"},"View Name",-1)),m("div",yt,[r(kt,{modelValue:p.value.icon,"onUpdate:modelValue":i[0]||(i[0]=l=>p.value.icon=l)},{default:f(({togglePopover:l})=>[r(_,{size:"md",class:"flex size-8 text-2xl leading-none",label:p.value.icon,onClick:l},null,8,["label","onClick"])]),_:1},8,["modelValue"]),r(o,{class:"flex-1",size:"md",type:"text",placeholder:"My Open Tickets",modelValue:p.value.label,"onUpdate:modelValue":i[1]||(i[1]=l=>p.value.label=l)},null,8,["modelValue"])])]),actions:f(()=>[r(_,{label:v.value.buttonLabel,variant:"solid",onClick:i[2]||(i[2]=l=>L("update",p.value,v.value.action)),class:"w-full"},null,8,["label"])]),_:1},8,["modelValue","options"])}}},ht=_t,Ht=ce({__name:"Tickets",setup(d){const c=Fe(),n=me(),{getCurrentUserViews:p,createView:v,publicViews:L,pinnedViews:b,findView:i,updateView:_,deleteView:o}=Pe("HD Ticket"),{$dialog:l,$socket:S}=Je(),{isManager:E}=Ne(),h=U(null),C=U(!1),{textColorMap:O}=qe(),N=U(new Set),ve=[{label:"Export",icon:"download",onClick:t=>{N.value=new Set(t),C.value=!0}}],we={doctype:"HD Ticket",columnConfig:{status:{prefix:({row:t})=>k(Ie,{class:O[t.status]})},agreement_status:{custom:({item:t})=>k(F,{label:t,theme:_e[t],variant:"outline"})},response_by:{custom:({row:t,item:e})=>be(t,e)},resolution_by:{custom:({row:t,item:e})=>ge(t,e)}},isCustomerPortal:T.value,selectable:!0,showSelectBanner:!0,selectBannerActions:ve,emptyState:{title:"No Tickets Found",icon:k(Ee,{class:"h-10 w-10"})},rowRoute:{name:T.value?"TicketCustomer":"TicketAgent",prop:"ticketId"},hideColumnSetting:!1};function be(t,e){return!t.first_responded_on&&B(e).isBefore(new Date)?k(F,{label:"Failed",theme:"red",variant:"outline"}):t.first_responded_on&&B(t.first_responded_on).isBefore(e)?k(F,{label:"Fulfilled",theme:"green",variant:"outline"}):B(t.first_responded_on).isAfter(e)?k(F,{label:"Failed",theme:"red",variant:"outline"}):k(se,{text:B(e).long()},()=>B.tz(e).fromNow())}function ge(t,e){return t.status==="Replied"?k(F,{label:"Paused",theme:"blue",variant:"outline"}):t.resolution_date&&B(t.resolution_date).isBefore(e)?k(F,{label:"Fulfilled",theme:"green",variant:"outline"}):B(t.resolution_date).isAfter(e)?k(F,{label:"Failed",theme:"red",variant:"outline"}):k(se,{text:B(e).long()},()=>B.tz(e).fromNow())}async function ke(t="Excel",e=!1){var R;const s=(R=h.value)==null?void 0:R.list;if(!s)return;const w=JSON.stringify(s.data.columns.map(g=>g.key)),A=s.params.order_by;let x={...s.params.filters},D;e?(x=JSON.stringify(x),D=s.data.total_count):(D=N.value.size,x.name=["in",Array.from(N.value)],x=JSON.stringify(x)),window.location.href=`/api/method/frappe.desk.reportview.export_query?file_format_type=${t}&title=HD Ticket&doctype=HD Ticket&fields=${w}&filters=${x}&order_by=${A}&page_length=${D}&start=0&view=Report&with_comment_count=1`,ye(),C.value=!1}function ye(t=!1){var e,s;(e=h.value)==null||e.unselectAll(),(s=N.value)==null||s.clear(),t&&h.value.reload()}const _e={Fulfilled:"green",Failed:"red","Resolution Due":"orange","First Response Due":"orange",Paused:"blue"};let u=de({show:!1,view:{label:"",icon:"",name:""},mode:"create"});const he=Y(()=>{var e,s,w;const t=[{group:"Default Views",items:[{label:"List View",icon:"align-justify",onClick:()=>c.push({name:T.value?"TicketsCustomer":"TicketsAgent"})}]}];return((e=p.value)==null?void 0:e.length)!==0&&t.push({group:"Saved Views",items:J(p.value)}),((s=b.value)==null?void 0:s.length)!==0&&t.push({group:"Private Views",items:J(b.value)}),((w=L.value)==null?void 0:w.length)!==0&&t.push({group:"Public Views",items:J(L.value)}),t.push({group:"Create View",hideLabel:!0,items:[{label:"Create View",icon:"plus",onClick:()=>{ee(),u.show=!0}}]}),t});let H=null;const Ce=t=>{const e=i(t.name).value;let s=[{group:"Default Views",hideLabel:!0,items:[{label:"Duplicate",icon:k(ae,{name:"copy"}),onClick:()=>{u.view.label=e.label+" (New)",u.view.icon=e.icon,u.view.name=e.name,u.mode="duplicate",H=e,u.show=!0}}]}];return(!e.public||E)&&(s[0].items.push({label:"Edit",icon:k(Oe,{class:"h-4 w-4"}),onClick:()=>{u.view.label=e.label,u.view.icon=e.icon,u.view.name=e.name,u.mode="edit",u.show=!0}}),e.public||s[0].items.push({label:e!=null&&e.pinned?"Unpin View":"Pin View",icon:k(e!=null&&e.pinned?et:Qe,{class:"h-4 w-4"}),onClick:()=>{const w={name:e.name};w.pinned=!e.pinned,_(w)}}),E&&!T.value&&s[0].items.push({label:e!=null&&e.public?"Make Private":"Make Public",icon:k(ae,{name:e!=null&&e.public?"lock":"unlock",class:"h-4 w-4"}),onClick:()=>{const w={name:e.name,public:!e.public};e.public?l({title:`Make ${e.label} private?`,message:"This view is currently public. Changing it to private will hide it for all the users.",actions:[{label:"Confirm",variant:"solid",onClick({close:A}){A(),_(w)}}]}):_(w)}}),s.push({group:"Delete View",hideLabel:!0,items:[{label:"Delete",icon:"trash-2",onClick:()=>{l({title:`Delete ${e.label}?`,message:`Are you sure you want to delete this view?
              ${e.public?"This view is public, and will be removed for all users.":""}`,actions:[{label:"Confirm",variant:"solid",onClick({close:w}){n.query.view===e.name&&c.push({name:T.value?"TicketsCustomer":"TicketsAgent"}),o(e.name),Z("deleted"),w()}}]})}}]})),s};function J(t){return t==null?void 0:t.map(e=>({...e,onClick:()=>{z.value={label:e.label,icon:e.icon},c.push({name:e.route_name,query:{view:e.name}})}}))}function xe(t,e){var w,A,x,D,R,g,j,te,le;let s;if(e==="update"){_(t),Z("updated"),z.value={label:t.label,icon:ie(t.icon)};return}else e==="duplicate"?s={...H,filters:JSON.stringify(H.filters),columns:JSON.stringify(H.columns),rows:JSON.stringify(H.rows),label:t.label,icon:t.icon,public:!1,pinned:!1}:s={dt:"HD Ticket",type:"list",label:t.label??"List",icon:t.icon??"",route_name:c.currentRoute.value.name,order_by:(A=(w=h.value)==null?void 0:w.list)==null?void 0:A.params.order_by,filters:JSON.stringify((D=(x=h.value)==null?void 0:x.list)==null?void 0:D.params.filters),columns:JSON.stringify((g=(R=h.value)==null?void 0:R.list)==null?void 0:g.data.columns),rows:JSON.stringify((le=(te=(j=h.value)==null?void 0:j.list)==null?void 0:te.data)==null?void 0:le.rows),is_customer_portal:T.value};v(s,G=>{z.value={label:G.label||"List",icon:ie(G.icon)},c.push({name:T.value?"TicketsCustomer":"TicketsAgent",query:{view:G.name}}),Z()})}function Z(t="created"){Re.success(`View ${t}`),ee()}function ee(){u.show=!1,u.view.label="",u.view.icon="",u.view.name="",u.mode=null,H=null}return De(()=>{n.query.view||(z.value={label:"List",icon:"lucide:align-justify"}),S.on("helpdesk:new-ticket",()=>{var t;(t=h.value)==null||t.reload()})}),Be(()=>({title:"Tickets"})),(t,e)=>{var x,D,R;const s=He,w=$("Button"),A=$("RouterLink");return a(),V("div",null,[r(y(Ue),null,{"left-header":f(()=>[r(rt,{label:"Tickets","route-name":y(T)?"TicketsCustomer":"TicketsAgent",options:he.value,"dropdown-actions":Ce,"current-view":y(z)},null,8,["route-name","options","current-view"])]),"right-header":f(()=>[r(A,{to:{name:y(T)?"TicketNew":"TicketAgentNew"}},{default:f(()=>[r(w,{label:"Create",theme:"gray",variant:"solid"},{prefix:f(()=>[r(s,{class:"h-4 w-4"})]),_:1})]),_:1},8,["to"])]),_:1}),r(y(ze),{ref_key:"listViewRef",ref:h,options:we,onEmptyStateAction:e[0]||(e[0]=()=>t.$router.push({name:y(T)?"TicketNew":"TicketAgentNew"})),onRowClick:e[1]||(e[1]=g=>t.$router.push({name:y(T)?"TicketCustomer":"TicketAgent",params:{ticketId:g}}))},null,512),r(lt,{modelValue:C.value,"onUpdate:modelValue":e[2]||(e[2]=g=>C.value=g),rowCount:((R=(D=(x=t.$refs.listViewRef)==null?void 0:x.list)==null?void 0:D.data)==null?void 0:R.total_count)??0,onUpdate:e[3]||(e[3]=({export_type:g,export_all:j})=>ke(g,j))},null,8,["modelValue","rowCount"]),y(u).show?(a(),M(ht,{key:0,modelValue:y(u),"onUpdate:modelValue":e[4]||(e[4]=g=>Ae(u)?u.value=g:u=g),onUpdate:e[5]||(e[5]=(g,j)=>xe(g,j))},null,8,["modelValue"])):q("",!0)])}}});export{Ht as default};
//# sourceMappingURL=Tickets-3f26a831.js.map
