import{c as h,r as g,e as i,k as u,F as m,G as v,f as y,aI as A,w as f,g as _,y as b,h as k}from"./index-54e545bb.js";import{_ as C}from"./Dropdown.vue_vue_type_script_setup_true_lang-20398480.js";const L={key:0,class:"flex gap-2"},j={key:2},N={__name:"CustomActions",props:{actions:{type:Object,required:!0}},setup(e){const a=e,n=h(()=>a.actions.filter(o=>!o.group)),t=h(()=>{let o=[];return a.actions.filter(r=>r.buttonLabel&&r.group).forEach(r=>{let c=o.findIndex(p=>p.label===r.buttonLabel);c>-1?o[c].action.push(r):o.push({label:r.buttonLabel,action:[r]})}),o}),s=h(()=>{let o=[];return o=o.concat(a.actions.filter(r=>r.group&&!r.buttonLabel)),o});return(o,r)=>{const c=g("FeatherIcon"),p=g("Button");return i(),u(m,null,[n.value.length?(i(),u("div",L,[(i(!0),u(m,null,v(n.value,l=>(i(),y(p,{key:l.label,label:l.label,onClick:d=>l.onClick()},A({_:2},[l.icon?{name:"prefix",fn:f(()=>[_(c,{name:l.icon,class:"h-4 w-4"},null,8,["name"])]),key:"0"}:void 0]),1032,["label","onClick"]))),128))])):b("",!0),s.value.length?(i(),y(k(C),{key:1,options:s.value},{default:f(()=>[_(p,{icon:"more-horizontal"})]),_:1},8,["options"])):b("",!0),t.value.length?(i(),u("div",j,[(i(!0),u(m,null,v(t.value,l=>(i(),u("div",{key:l.label},[_(k(C),{options:l.action},{default:f(({open:d})=>[_(p,{label:l.label},{suffix:f(()=>[_(c,{name:d?"chevron-up":"chevron-down",class:"h-4"},null,8,["name"])]),_:2},1032,["label"])]),_:2},1032,["options"])]))),128))])):b("",!0)],64)}}};async function q(e,a){let n=e==null?void 0:e.data;if(!n)return;if(!n._form_script)return[];let t=[],s={};if(Array.isArray(n._form_script))for(const o of n._form_script){const r=await w(o,a);t=t.concat(r.actions),r.onChange&&F(s,r.onChange)}else{const o=await w(n._form_script,a);t=o.actions,o.onChange&&F(s,o.onChange)}n._customActions=t,Object.keys(s).length&&(n._customOnChange=s)}function F(e,a){for(const[n,t]of Object.entries(a))e[n]||(e[n]=new Set),e[n].add(t)}async function w(e,a){const t=await new Function(e+`
return setupForm`)()(a);return{actions:(t==null?void 0:t.actions)||[],onChange:(t==null?void 0:t.onChange)||null}}function E(e,a,n,t,s){n?e.options=n.join(`
`):e.options=s.find(o=>o.fieldname===a).options,t[a]=""}function S(e,a,n,t,s){if(!n){e.link_filters=s.find(o=>o.fieldname===a).link_filters;return}e.link_filters=JSON.stringify([[e.options,"name","in",n]]),t[a]=""}function V(e,a){return{display_via_depends_on:O(e==null?void 0:e.depends_on,a),...e,required:e.required||e.mandatory_depends_on&&O(e.mandatory_depends_on,a),filters:e.link_filters&&JSON.parse(e.link_filters)}}function O(e,a){if(!e)return!0;let n=null;if(e.substr(0,5)=="eval:")try{n=x(e.substr(5),{doc:a})}catch{n=!0}else if(e.substr(0,4)=="doc.")n=a[e.substr(4)];else{let t=a[e];Array.isArray(t)?n=!!t.length:n=!!t}return n}function x(e,a={}){let n=Object.keys(a),t=Object.values(a);e=`let out = ${e}; return out`;try{return new Function(...n,e)(...t)}catch(s){throw console.log("Error evaluating the following expression:"),console.error(e),s}}export{N as _,S as a,E as h,V as p,q as s};
//# sourceMappingURL=formCustomisation-44f18b9b.js.map
