{"version":3,"file":"NewArticle-f72715a7.js","sources":["../../../../desk/src/pages/knowledge-base/NewArticle.vue"],"sourcesContent":["<template>\n  <div class=\"flex flex-col flex-1\">\n    <LayoutHeader>\n      <template #left-header>\n        <Breadcrumbs :items=\"breadcrumbs\" />\n      </template>\n      <template #right-header> </template>\n    </LayoutHeader>\n    <div class=\"pt-6 mx-auto w-full max-w-4xl px-5\">\n      <div class=\"flex flex-col gap-3 rounded-lg border w-full p-4\">\n        <div class=\"flex justify-between items-center mb-3\">\n          <!-- Author Info -->\n          <div\n            class=\"flex gap-1 items-center flex-1 mr-7 max-w-fit overflow-hidden\"\n          >\n            <UserAvatar :name=\"user.name\" :expand=\"true\" />\n            <span>in</span>\n            <Link\n              class=\"form-control\"\n              doctype=\"HD Article Category\"\n              placeholder=\"Select Category\"\n              v-model=\"categoryId\"\n              :pageLength=\"100\"\n              :hide-clear-button=\"true\"\n            />\n          </div>\n          <!-- Action Buttons -->\n          <div class=\"flex gap-2\">\n            <Button label=\"Discard\" @click=\"handleArticleDiscard\" />\n            <Button\n              label=\"Create\"\n              variant=\"solid\"\n              @click=\"handleCreateArticle\"\n            />\n          </div>\n        </div>\n        <!-- Title -->\n        <textarea\n          class=\"w-full resize-none border-0 text-3xl font-bold placeholder-ink-gray-3 p-0 pb-3 border-b border-gray-200 focus:ring-0 focus:border-gray-200\"\n          v-model=\"title\"\n          placeholder=\"Title\"\n          rows=\"1\"\n          wrap=\"soft\"\n          maxlength=\"140\"\n          autofocus\n          @input=\"\n          (e: Event) => {\n            const target = e.target as HTMLTextAreaElement;\n            target.style.height = `${target.scrollHeight}px`;\n          }\n          \"\n        />\n        <!-- Article Content -->\n        <TextEditor\n          :content=\"content\"\n          @change=\"content = $event\"\n          placeholder=\"Write your article here...\"\n          editor-class=\"rounded-b-lg max-w-[unset] prose-sm h-[calc(100vh-340px)] sm:h-[calc(100vh-250px)] overflow-auto\"\n        >\n          <template #bottom>\n            <TextEditorFixedMenu\n              class=\"-ml-1 overflow-x-auto w-full\"\n              :buttons=\"textEditorMenuButtons\"\n            />\n          </template>\n        </TextEditor>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport {\n  Breadcrumbs,\n  TextEditor,\n  TextEditorFixedMenu,\n  toast,\n  usePageMeta,\n} from \"frappe-ui\";\nimport { useOnboarding } from \"frappe-ui/frappe\";\nimport { computed, ref } from \"vue\";\n\nimport { LayoutHeader, UserAvatar } from \"@/components\";\nimport { useAuthStore } from \"@/stores/auth\";\nimport { globalStore } from \"@/stores/globalStore\";\nimport { newArticle } from \"@/stores/knowledgeBase\";\nimport { useUserStore } from \"@/stores/user\";\nimport { Article } from \"@/types\";\nimport { textEditorMenuButtons } from \"@/utils\";\nimport { useRoute, useRouter } from \"vue-router\";\n\nconst userStore = useUserStore();\nconst user = userStore.getUser();\nconst { $dialog } = globalStore();\nconst router = useRouter();\nconst route = useRoute();\nconst { updateOnboardingStep } = useOnboarding(\"helpdesk\");\nconst { isManager } = useAuthStore();\n\nconst title = ref(\"\");\nconst content = ref(\"\");\n\nconst props = defineProps({\n  id: {\n    type: String,\n    required: true,\n  },\n});\n\nconst categoryId = ref(props.id || null);\nconst categoryName = computed(() => (route.query.title as string) || \"\");\n\nfunction handleCreateArticle() {\n  newArticle.submit(\n    { title: title.value, content: content.value, category: categoryId.value },\n    {\n      onSuccess: (article: Article) => {\n        toast.success(\"Article created\");\n        if (isManager) {\n          updateOnboardingStep(\"first_article\");\n        }\n        resetState();\n        router.push({\n          name: \"Article\",\n          params: {\n            articleId: article.name,\n          },\n        });\n      },\n      onError: (error: string) => {\n        toast.error(error);\n      },\n    }\n  );\n}\nfunction handleArticleDiscard() {\n  if (!title.value && !content.value) {\n    router.push({\n      name: \"AgentKnowledgeBase\",\n    });\n    return;\n  }\n  $dialog({\n    title: \"Discard Article\",\n    message: \"Are you sure you want to discard this article?\",\n    actions: [\n      {\n        label: \"Confirm\",\n        variant: \"solid\",\n        onClick(close: Function) {\n          router.push({\n            name: \"AgentKnowledgeBase\",\n          });\n          resetState();\n          close();\n        },\n      },\n    ],\n  });\n}\n\nfunction resetState() {\n  title.value = \"\";\n  content.value = \"\";\n}\n\nconst breadcrumbs = computed(() => {\n  const options: Array<{ label: string; route?: { name: string } }> = [\n    {\n      label: \"Knowledge Base\",\n      route: { name: \"AgentKnowledgeBase\" },\n    },\n  ];\n  if (categoryName.value) {\n    options.push({\n      label: categoryName.value,\n      route: { name: \"AgentKnowledgeBase\" },\n    });\n  }\n  options.push({\n    label: \"New Article\",\n  });\n  return options;\n});\n\nusePageMeta(() => {\n  return {\n    title: \"New Article\",\n  };\n});\n</script>\n"],"names":["user","useUserStore","$dialog","globalStore","router","useRouter","route","useRoute","updateOnboardingStep","useOnboarding","isManager","useAuthStore","title","ref","content","categoryId","__props","categoryName","computed","handleCreateArticle","newArticle","article","toast","resetState","error","handleArticleDiscard","close","breadcrumbs","options","usePageMeta","_openBlock","_createElementBlock","_hoisted_1","_createVNode","_unref","LayoutHeader","Breadcrumbs","_cache","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","UserAvatar","_component_Link","$event","_hoisted_6","_component_Button","e","target","TextEditor","TextEditorFixedMenu","textEditorMenuButtons"],"mappings":"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"}