import{d as M,m as x,n as V,c as H,A as m,a4 as J,f as U,w as b,h as _,e as S,l as w,az as O,aW as W,H as E,r as X,s as $,t as j,g,p as F,X as Q,M as Y,aP as D,N as Z,k as ee,R as d,u as te,aN as le,I as B,S as ae,J as oe,U as se,a5 as re}from"./index-54e545bb.js";import{L as ie,m as ne,n as ue,a as ce,b as de,d as ge,c as me}from"./knowledgeBase-de4d1c97.js";import{_ as pe}from"./ListViewBuilder.vue_vue_type_script_setup_true_lang-23f24b4c.js";import"./more-horizontal-b561c647.js";import"./dayjs-8f71cd34.js";import{_ as fe}from"./Link-5130f40e.js";import{_ as ye}from"./MoveToCategoryModal.vue_vue_type_script_setup_true_lang-5a7b3c6a.js";import{g as ve}from"./globalStore-842ad0ec.js";import{_ as be}from"./Dropdown.vue_vue_type_script_setup_true_lang-20398480.js";import{L as Ce}from"./merge-149ec802.js";import"./StarRating.vue_vue_type_script_setup_true_lang-87d7ba3b.js";import"./FadedScrollableDiv.vue_vue_type_script_setup_true_lang-897d9728.js";import"./Avatar.vue_vue_type_script_setup_true_lang-33c4215a.js";import"./DateRangePicker.vue_vue_type_script_setup_true_lang-fc0fa242.js";import"./EmptyState.vue_vue_type_script_setup_true_lang-93f57bdf.js";const he={class:"flex flex-col flex-1 gap-3"},_e=M({__name:"CategoryModal",props:x({title:{type:String,default:""},edit:{type:Boolean,default:!1}},{modelValue:{type:Boolean},modelModifiers:{},title:{},titleModifiers:{}}),emits:x(["update","create"],["update:modelValue","update:title"]),setup(C,{emit:f}){const y=C,l=f,c=V(C,"modelValue"),r=V(C,"title"),a=H(()=>y.edit?"Edit Category":"Create Category"),n=m(null);J(()=>n.value,i=>{i&&(n.value.style.height=(i.scrollHeight>i.clientHeight,i.scrollHeight+"px"))});function u(){const i=[];return y.edit?i.push({label:"Save",variant:"solid",onClick:()=>{l("update")}}):i.push({label:"Create",variant:"solid",onClick:()=>{l("create")}}),i}return(i,p)=>(S(),U(_(E),{modelValue:c.value,"onUpdate:modelValue":p[2]||(p[2]=v=>c.value=v),options:{title:a.value,actions:u()}},{"body-content":b(()=>[w("div",he,[O(w("textarea",{class:"text-base rounded py-1.5 px-2 border border-[--surface-gray-2] bg-surface-gray-2 placeholder-ink-gray-4 hover:border-outline-gray-modals hover:bg-surface-gray-3 focus:bg-surface-white focus:border-outline-gray-4 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3 text-ink-gray-8 transition-colors w-full block",ref_key:"titleRef",ref:n,placeholder:"Support Issues","onUpdate:modelValue":p[0]||(p[0]=v=>r.value=v),rows:1,maxlength:"50",autofocus:"",onInput:p[1]||(p[1]=v=>{const k=v.target;k.style.height=`${k.scrollHeight}px`})},null,544),[[W,r.value]])])]),_:1},8,["modelValue","options"]))}}),we={class:"text-p-base text-ink-gray-8 mb-4"},ke={class:"whitespace-nowrap font-semibold"},Ae=M({__name:"MergeCategoryModal",props:x({categoryId:{},categoryTitle:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:x(["merge"],["update:modelValue"]),setup(C,{emit:f}){const y=f,l=V(C,"modelValue"),c=m("");return(r,a)=>{const n=X("Button");return S(),U(_(E),{options:{title:"Merge with another category"},onAfterLeave:a[2]||(a[2]=()=>{c.value=null}),modelValue:l.value,"onUpdate:modelValue":a[3]||(a[3]=u=>l.value=u)},{"body-content":b(()=>[w("p",we,[a[4]||(a[4]=$(" This will move all articles of the ")),w("span",ke,j(r.categoryTitle),1),a[5]||(a[5]=$(" category to the selected category. This change is irreversible! "))]),g(_(fe),{class:"form-control",doctype:"HD Article Category",placeholder:"Select Category",modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=u=>c.value=u),label:"Category","page-length":100},null,8,["modelValue"])]),actions:b(()=>[g(n,{class:"w-full",variant:"solid",label:"Merge",onClick:a[1]||(a[1]=u=>y("merge",r.categoryId,c.value))})]),_:1},8,["modelValue"])}}}),xe={class:"flex flex-col"},qe=M({__name:"KnowledgeBaseAgent",setup(C){const f=te(),{$dialog:y}=ve(),l=F({title:"",id:""}),c=m(""),r=m(null),a=m(!1),n=m(!1),u=m(!1),i=m(!1),p=Q({url:"helpdesk.api.knowledge_base.get_general_category",auto:!0,cache:["GeneralCategory"]}),v=[{label:"Category",icon:"folder",onClick:()=>{A(),a.value=!1,n.value=!0}},{label:"Article",icon:"file-text",onClick:()=>{f.push({name:"NewArticle",params:{id:p.data},query:{title:"General"}})}}],k=[{label:"Add New Article",icon:"plus",onClick:e=>{f.push({name:"NewArticle",params:{id:e.group.value},query:{title:e.group.label}})}},{label:"Edit Title",icon:"edit",onClick:e=>{a.value=!0,n.value=!0,l.title=e.group.label,l.id=e.group.value,c.value=e.group.label}},{label:"Merge",icon:Ce,onClick:e=>{i.value=!0,l.title=e.group.label,l.id=e.group.value}},{label:"Share",icon:"link",onClick:async({group:e})=>{const{label:t,value:o}=e,s=new URL(window.location.href);s.pathname=`/helpdesk/kb-public/${o}`,await re()}},{label:"Delete",icon:"trash-2",onClick:e=>{P(e)}}],h=m(new Set),N=[{label:"Move To",icon:"corner-up-right",onClick:e=>{h.value=new Set(e),u.value=!0}},{label:"Delete",icon:"trash-2",onClick:e=>{h.value=e,y({title:"Delete articles?",message:"Are you sure you want to delete these articles?",actions:[{label:"Confirm",variant:"solid",onClick({close:t}){q(),t()}}]})}}];function I(e){ne.submit({category:e,articles:Array.from(h.value)},{onSuccess:()=>{var t,o;u.value=!1,(t=r.value)==null||t.reload(),(o=r.value)==null||o.unselectAll(),h.value.clear(),d.success("Articles moved")},onError:t=>{var s;const o=((s=t==null?void 0:t.messages)==null?void 0:s[0])||t.message;d.error(o),u.value=!1}})}function L(){ue.submit({title:l.title},{onSuccess:e=>{r.value.reload(),n.value=!1,f.push({name:"Article",params:{articleId:e.article},query:{category:e.category,title:l.title,isEdit:1}}),d.success("Category created"),D("category_created",{data:{category:l.title}}),A()},onError:e=>{d.error(e)}})}function R(){if(l.title===c.value){n.value=!1,a.value=!1;return}ce.submit({doctype:"HD Article Category",name:l.id,fieldname:"category_name",value:l.title},{onSuccess:()=>{r.value.reload(),n.value=!1,a.value=!1,d.success("Category updated"),A()},onError:e=>{d.error(e)}})}function P(e){y({title:"Delete category?",message:"All articles from this category will move to General category.",actions:[{label:"Confirm",variant:"solid",onClick(t){ge.submit({doctype:"HD Article Category",name:e.group.value},{onSuccess:()=>{d.success("Category deleted"),r.value.reload()}}),t()}}]})}function q(){me.submit({articles:Array.from(h.value)},{onSuccess:()=>{var e,t,o;(e=r.value)==null||e.reload(),(t=r.value)==null||t.unselectAll(),(o=h.value)==null||o.clear(),d.success("Articles deleted")}})}function G(e,t){de.submit({source:e,target:t},{onSuccess:()=>{r.value.reload(),d.success("Category merged"),i.value=!1,A()},onError:o=>{var T;const s=((T=o==null?void 0:o.messages)==null?void 0:T[0])||o.message;d.error(s)}})}function A(){l.title="",l.id="",c.value=""}const K=H(()=>({doctype:"HD Article",selectable:!0,view:{view_type:"group_by",group_by_field:"category",label_doc:"HD Article Category",label_field:"category_name"},columnConfig:{title:{prefix:()=>B(ae,{name:"file-text",class:"h-4 w-4 flex-shrink-0 text-ink-gray-6"})},status:{custom:({item:e})=>B(oe,{...z[e]})}},rowRoute:{name:"Article",prop:"articleId"},groupByActions:k,showSelectBanner:!0,selectBannerActions:N,default_page_length:100})),z={Published:{label:"Published",theme:"green"},Draft:{label:"Draft",theme:"orange"},Archived:{label:"Archived",theme:"gray"}};return Y(()=>{D("kb_agent_page_viewed")}),Z(()=>({title:"Knowledge Base"})),(e,t)=>{const o=se;return S(),ee("div",xe,[g(ie,null,{"left-header":b(()=>t[5]||(t[5]=[w("div",{class:"text-lg font-medium text-gray-900"},"Knowledge Base",-1)])),"right-header":b(()=>[g(_(be),{options:v},{default:b(()=>[g(_(le),{label:"Add new",variant:"solid"},{prefix:b(()=>[g(o,{class:"h-4 w-4"})]),_:1})]),_:1})]),_:1}),g(pe,{ref_key:"listViewRef",ref:r,options:K.value,onRowClick:t[0]||(t[0]=s=>e.$router.push(`kb/articles/${s}`))},null,8,["options"]),g(_e,{edit:a.value,modelValue:n.value,"onUpdate:modelValue":t[1]||(t[1]=s=>n.value=s),title:l.title,"onUpdate:title":t[2]||(t[2]=s=>l.title=s),onUpdate:R,onCreate:L},null,8,["edit","modelValue","title"]),g(ye,{modelValue:u.value,"onUpdate:modelValue":t[3]||(t[3]=s=>u.value=s),onMove:I},null,8,["modelValue"]),g(Ae,{categoryTitle:l.title,"category-id":l.id,modelValue:i.value,"onUpdate:modelValue":t[4]||(t[4]=s=>i.value=s),onMerge:G},null,8,["categoryTitle","category-id","modelValue"])])}}});export{qe as default};
//# sourceMappingURL=KnowledgeBaseAgent-43a197da.js.map
